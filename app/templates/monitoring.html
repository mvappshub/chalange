{% extends "base.html" %}
{% block title %}Monitoring | {{ app_name }}{% endblock %}
{% block page_title %}Monitoring{% endblock %}
{% block page_subtitle %}Live system health, entity volume, and request performance in one dashboard view.{% endblock %}
{% block content %}
<section class="panel">
  <div class="panel-header">
    <h2>System Status</h2>
    <a class="button button-ghost button-sm mono" href="/api/status">/api/status</a>
  </div>
  <div class="bento-grid">
    <article class="status-card {% if status.api_ok %}is-ok{% else %}is-bad{% endif %}">
      <h3><span class="status-dot {% if status.api_ok %}ok{% else %}bad{% endif %}"></span>API</h3>
      <p class="muted">Request layer responsiveness.</p>
      <p class="metric-value">{% if status.api_ok %}Healthy{% else %}Down{% endif %}</p>
    </article>
    <article class="status-card {% if status.db_ok %}is-ok{% else %}is-bad{% endif %}">
      <h3><span class="status-dot {% if status.db_ok %}ok{% else %}bad{% endif %}"></span>Database</h3>
      <p class="muted">Read/write and counting checks.</p>
      <p class="metric-value">{% if status.db_ok %}Connected{% else %}Unavailable{% endif %}</p>
    </article>
    <article class="status-card {% if status.watcher_last_run_at %}is-ok{% else %}is-warn{% endif %}">
      <h3><span class="status-dot {% if status.watcher_last_run_at %}ok{% else %}warn{% endif %}"></span>Watcher</h3>
      <p class="muted">Escalation runtime heartbeat.</p>
      <p class="mono">{% if status.watcher_last_run_at %}{{ status.watcher_last_run_at }}{% else %}never{% endif %}</p>
      <p class="muted">created_incidents={{ status.watcher_created_incidents }}</p>
    </article>
    <article class="status-card {% if status.ai_gemini_key_present %}is-ok{% else %}is-warn{% endif %}">
      <h3><span class="status-dot {% if status.ai_gemini_key_present %}ok{% else %}warn{% endif %}"></span>AI Provider</h3>
      <p class="muted">Gemini key availability.</p>
      <p class="metric-value">{% if status.ai_gemini_key_present %}Configured{% else %}Fallback Mode{% endif %}</p>
    </article>
  </div>
</section>

<section class="panel">
  <h2>Entity Counts</h2>
  <div class="metric-grid">
    <article class="metric-card">
      <p class="metric-label">Cards</p>
      <p class="metric-value">{{ counts.cards }}</p>
    </article>
    <article class="metric-card">
      <p class="metric-label">Alerts</p>
      <p class="metric-value">{{ counts.alerts }}</p>
    </article>
    <article class="metric-card">
      <p class="metric-label">Incidents</p>
      <p class="metric-value">{{ counts.incidents }}</p>
    </article>
    <article class="metric-card">
      <p class="metric-label">Audit Events</p>
      <p class="metric-value">{{ counts.audit_events }}</p>
    </article>
  </div>
</section>

<section class="panel">
  <div class="panel-header">
    <h2>HTTP Metrics</h2>
    <a class="button button-ghost button-sm mono" href="/metrics">/metrics</a>
  </div>
  <div class="metric-grid">
    <article class="metric-card">
      <p class="metric-label">Total Requests</p>
      <p class="metric-value">{{ metrics.requests_total }}</p>
    </article>
    <article class="metric-card">
      <p class="metric-label">Average Latency (ms)</p>
      <p class="metric-value">{{ "%.2f"|format(metrics.request_latency_ms_avg) }}</p>
    </article>
  </div>
</section>
{% endblock %}
