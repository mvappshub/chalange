{% extends "base.html" %}
{% block content %}
<section class="panel">
  <h2>{{ incident.title }}</h2>
  <p><strong>Status:</strong> {{ incident.status }} | <strong>Severity:</strong> {{ incident.severity }}</p>
  <p>{{ incident.summary }}</p>
  <form method="post" action="/incidents/{{ incident.id }}/status">
    <select name="status">
      <option value="investigating">investigating</option>
      <option value="mitigated">mitigated</option>
      <option value="resolved">resolved</option>
    </select>
    <button type="submit">Update status</button>
  </form>
</section>
<section class="panel">
  <h3>AI actions</h3>
  <div class="button-row">
    <button
      hx-post="/api/agent/run?incident_id={{ incident.id }}&mode=triage"
      hx-swap="none"
      hx-on::after-request="window.location.reload()"
    >
      Run AI triage
    </button>
    <button
      hx-post="/api/agent/run?incident_id={{ incident.id }}&mode=plan"
      hx-swap="none"
      hx-on::after-request="window.location.reload()"
    >
      Propose tasks
    </button>
  </div>
  {% if triage_note %}
  <p><strong>Latest triage:</strong> {{ triage_note.content }}</p>
  {% else %}
  <p class="muted">No triage note yet.</p>
  {% endif %}
  <h4>Remediation cards</h4>
  <ul>
    {% for card in remediation_cards %}
    <li>{{ card.title }}</li>
    {% else %}
    <li>No AI remediation cards yet</li>
    {% endfor %}
  </ul>
</section>
<section class="panel">
  <h3>Timeline (audit)</h3>
  <ul>
    {% for event in timeline %}
    <li>{{ event.created_at }} | {{ event.action }} | {{ event.payload }}</li>
    {% else %}
    <li>No events</li>
    {% endfor %}
  </ul>
</section>
{% endblock %}
